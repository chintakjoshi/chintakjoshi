const gifPlaybackTimers=new WeakMap(),gifDurationCache=new Map(),DEFAULT_GIF_DURATION_MS=4e3;function parseGifDurationMs(e){if(e.length<13)return null;const t=String.fromCharCode(...e.slice(0,6));if("GIF87a"!==t&&"GIF89a"!==t)return null;let i=6;i+=4;const o=e[i++];if(i+=2,o&128){const t=3*2**((7&o)+1);i+=t}let n=0;for(;i<e.length;){const t=e[i++];if(59===t)break;if(33===t){const t=e[i++];if(249===t){const t=e[i++];if(4!==t||i+4>e.length)return null;i+=1;const o=e[i]+(e[i+1]<<8);n+=o>0?o:10,i+=2,i+=1,i+=1}else for(;i<e.length;){const t=e[i++];if(0===t)break;i+=t}continue}if(44===t){if(i+9>e.length)return null;const t=e[i+8];if(i+=9,t&128){const o=3*2**((7&t)+1);i+=o}for(i+=1;i<e.length;){const t=e[i++];if(0===t)break;i+=t}continue}return null}return n?10*n:null}async function getGifDurationMs(e){if(gifDurationCache.has(e))return gifDurationCache.get(e);try{const t=await fetch(e,{cache:"force-cache"});if(!t.ok)throw new Error("Failed to fetch GIF");const i=parseGifDurationMs(new Uint8Array(await t.arrayBuffer()));if(!i)throw new Error("Could not parse GIF duration");return gifDurationCache.set(e,i),i}catch(t){return gifDurationCache.set(e,DEFAULT_GIF_DURATION_MS),DEFAULT_GIF_DURATION_MS}}async function toggleGif(e,t){e.preventDefault();const i=e.target.querySelector("img")??e.target,o=new URL(t,window.location.href).href;i.dataset.staticSrc||(i.dataset.staticSrc=i.currentSrc||i.src);const n=gifPlaybackTimers.get(i);n&&clearTimeout(n),i.src!==o&&(i.src=o);const a=await getGifDurationMs(o),r=setTimeout(()=>{i.src=i.dataset.staticSrc,gifPlaybackTimers.delete(i)},2*a);gifPlaybackTimers.set(i,r)}const copyButtonLabel="Copy markdown";let blocks=document.querySelectorAll("pre");blocks.forEach(e=>{if(navigator.clipboard){let t=document.createElement("button");t.innerText=copyButtonLabel,t.addEventListener("click",copyCode),e.appendChild(t)}});async function copyCode(e){const t=e.srcElement,i=t.parentElement,o=i.querySelector("code"),n=o.innerText;await navigator.clipboard.writeText(n),t.innerText="Copied!",setTimeout(()=>{t.innerText=copyButtonLabel},2e3)}
